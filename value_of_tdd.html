<html>
<head>
  <title>On Unit Testing</title>
  <script>
    var NextQueue = function()
    {
      this._story_queue = [];
      var story_size_distribution = [1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 4];
      
      for(var index in story_size_distribution)
      {
        var user_story = new UserStory()
        user_story.size = story_size_distribution[index];
        this._story_queue.push(user_story);
      }
    };    
    NextQueue.prototype.pull_next_story_to = function(queue)
    {
      var backlog_length = this._story_queue.length;
      alert('backlog length is: ' + backlog_length);
    
      var next_story = this._story_queue.pop();
      
      queue.add(next_story);
    };
    NextQueue.prototype.add_as_top_priority = function(story)
    {
      this._story_queue.push(story);
    };
    
    var WipQueue = function()
    {
      this._velocity = 1;
    };
    
    var DoneQueue = function()
    {
      this._failure_rate = .1;
      this._story_queue = [];
    };
    DoneQueue.prototype.add = function(story)
    {
      this._story_queue.push(story);
    };
    DoneQueue.prototype.test_stories_and_pull_failures_to = function(queue)
    {
      for(var story_index in this._story_queue)
      {
        var random_number = Math.random();
        
        if(random_number <= this._failure_rate)
        {
          var current_story = this._story_queue.pop();
          queue.add(current_story);
        }
      }
    };
    
    var BugQueue = function()
    {
      this._story_queue = [];
    };
    BugQueue.prototype.add = function(story)
    {
      this._story_queue.push(story);
    };
    BugQueue.prototype.prioritize_and_move_bugs_to = function(queue)
    {
      for(var index in this._story_queue)
      {
        var story = this._story_queue[index];
        queue.add_as_top_priority(story);
      }
    };
    
    var UserStory = function()
    {
    };
    UserStory.prototype.size = 0;
    
    var DevelopmentProcess = function(next_queue, done_queue, bug_queue)
    {
      this._next_queue = next_queue;
      this._done_queue = done_queue;
      this._bug_queue = bug_queue;
    };
    DevelopmentProcess.prototype.iterate = function()
    {
      this._next_queue.pull_next_story_to(this._done_queue);
      this._done_queue.test_stories_and_pull_failures_to(this._bug_queue);
      this._bug_queue.prioritize_and_move_bugs_to(this._next_queue);
    };
    
    var development_process = new DevelopmentProcess(new NextQueue(), new DoneQueue(), new BugQueue());
    development_process.iterate();
    development_process.iterate();
    development_process.iterate();
    development_process.iterate();
    development_process.iterate();
    development_process.iterate();
    development_process.iterate();
    
  </script>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>NEXT</th>
        <th>DONE</th>
        <th>BUGS</th>
      </tr>
    </thead>
    <tr>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </table>
</body>
</html>